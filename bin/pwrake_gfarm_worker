#!/usr/bin/env ruby

libpath = File.absolute_path(File.dirname(__FILE__))+"/../lib"
$LOAD_PATH.unshift libpath

require "pwrake/worker/load"
require "pwrake/worker/gfarm_directory"

begin
  base_dir, work_dir, log_dir, n_core = *ARGV
  dir_cls = Pwrake::GfarmDirectory
  dir_cls.init(base_dir, work_dir, log_dir)
  Pwrake::Invoker.new(dir_cls, n_core).run
rescue => exc
  log = Pwrake::LogExecutor.instance
  log.error exc
  log.error exc.backtrace.join("\n")
end
